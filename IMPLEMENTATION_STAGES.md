# План реалізації на Node.js (на основі поточних скриптів)

Ціль: перенести існуючу логіку з Apps Script у Node.js + БД, з адмін‑панеллю і високою пропускною здатністю.

---

## 1) База даних і мінімальна структура
**Потрібно тільки те, що відповідає скриптам.**
- `suppliers` — постачальники, % націнки, пріоритет.
- `sources` — посилання на Google Sheets/Drive/Excel, тип джерела.
- `column_mappings` — мапінг колонок для кожного постачальника.
- `products_raw` — сирі дані з джерел.
- `products_final` — фінальна таблиця для Horoshop.
- `price_overrides` — ручні ціни (як "Ручний склад").
- `jobs` і `logs` — історія запусків і помилки.

## 2) Імпорт постачальників (як у скриптах)
- Беремо лише стабільне посилання на файл.
- Назва таблиці/аркуша може змінюватись — шукаємо заголовки автоматично.
- Підтримка Google Sheets + Excel (upload або Drive).
- Авто‑мапінг колонок по заголовках + можливість ручного мапінгу в адмінці.
- Валідація: ціна > 0, кількість числова (пусто → 1), артикул не пустий.
- Логи при зміні заголовків або якщо колонки не знайдені.

## 3) Логіка обробки (1 в 1 зі скриптів)
- Націнка у % для кожного постачальника.
- Мінімальний прибуток: якщо < 500 грн — примусово +500.
- Округлення вгору до 10 грн.
- Дублікати: ключ артикул (+ розмір), залишаємо мінімальну ціну.
- Пріоритети постачальників (як у поточній логіці).
- Ручні ціни мають найвищий пріоритет.

## 4) Формування фінального файлу
- Генеруємо фінальну таблицю `products_final`.
- Сортування за артикулом.
- Експорт у форматі, який очікує Horoshop (Excel/CSV).

## 5) Оновлення Horoshop
- Ключ: артикул.
- Якщо артикулу немає → видимість "Ні".
- Якщо є → видимість "Так" + оновлення ціни.
- Завантаження файлу в Horoshop або через API (як буде погоджено).

## 6) Адмін‑панель (мінімум)
- Додавання/редагування постачальників і джерел.
- Налаштування мапінгу колонок.
- Налаштування % націнки та пріоритетів.
- Ручні ціни.
- Кнопка ручного запуску імпорту/експорту.
- Логи запусків і помилок.

## 7) Автоматизація
- Cron 1–3 рази на добу.
- Захист від паралельних запусків.

## 8) Продуктивність (500k+ позицій)
- Потокове читання файлів.
- Пакетний запис у БД.
- Індекси по артикулу і постачальнику.
- Черга задач (BullMQ/Redis) для великих запусків.

---

Цей план максимально простий і напряму повторює логіку поточних скриптів, але переносить її в Node.js + БД і додає адмін‑панель, логи та масштабування.
