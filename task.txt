mergeSheets();
function mergeSheets() {
 var configs = [
    { 
      id: '1ovtpRg6_n9ws1986DBFHcGex9IDhrLjmzLV21Q1dB9w', //–î–†–û–ü SPORTWEAR_DEALER
      sheetName: '–õ–∏—Å—Ç1', 
      columns: { article: 'B', size: 'F', quantity: 'E', price: 'G', extra: 'D'}
    },
    {
      id: '1s_IqwvekpAWdvqoLG_xc2D8YwQK-hsHI_GA41-zJuhw', //transpon test
      sheetName: 'Stock', 
      columns: { article: 'A', size: 'B', quantity: 'C', price: 'D' }
    },
    { 
      id: '1Z8H9Q8VeWz0_36wuJMj7KpiktvLsEqUWaSsWZ0NCRyw', //ofc_dropshipping idealsport
      sheetName: 'OFC Dropshipping Items', 
      columns: { article: 'F', size: 'G', quantity: 'I', price: 'H' }
    },
    { 
      id: '1TnDlWw4m4pC72qFsmSLbuv-_jSEDOoG5el09FFM2bAY', //NikeShop RED.BOX.SNS
      sheetName: 'Shoes', 
      columns: { article: 'B', size: 'D', quantity: 'F', price: 'E', extra: 'C' }
    },
    { 
      id: '1xd4wvljYBVwXTQ4V9Q4oL2LzxD8v7gOdd57p5JDb08k', //Drop vzuti
      sheetName: '–õ–∏—Å—Ç1', 
      columns: { article: 'C', size: 'D', quantity: 'Z', price: 'E', extra: 'B'}
    },
    { 
      id: '1tWyvhmomn8QFLR4BSMYERD3qtWlinSyBV6O0Nx3mxyA', //DROPSHIPPING CROSS UP
      sheetName: '1', 
      columns: { article: 'B', size: 'C', quantity: 'D', price: 'E' }
    },
    { 
      id: '1YtY51wjxmMu0XaMR-M0DzVH4h5pwvZd2Bc0dkWQNBM0', //merezha.cross
      sheetName: '–ê—Ä–∫—É—à1', 
      columns: { article: 'A', size: 'D', quantity: 'C', price: 'G' }
    },
    { 
      id: '1OMxsWn9jf6RYgKpiPI0E3Eif-Ykot5AmWlyQtAj0Cl0', //sneakers_market13
      sheetName: '–õ–∏—Å—Ç1', 
      columns: { article: 'B', size: 'E', quantity: 'C', price: 'G' }
    },
    { 
      id: '1a2RiNRcKAjptpyARfDYuZz-5U2G6B9Ww9d7ZmpdT5UY', //sevrukosha drop
      sheetName: '–ù–∞—è–≤–Ω—ñ—Å—Ç—å', 
      columns: { article: 'D', size: 'C', quantity: 'Z', price: 'F' }
    },
    { 
      id: '1SLudqOnFrgaBZJulRwW00V_T9M1ToCrRLuTJPncyz0A', //–î—Ä–æ–ø MYSIZE
      sheetName: '–õ–∏—Å—Ç1', 
      columns: { article: 'B', size: 'C', quantity: 'Z', price: 'G' }
    },
    { 
     id: '1GeTHvJdgg7snuHYY3Dlq507EETNmsnkWsfvbEGn65dE', //export_drop yes_original, –≤–∏–∫–ª—é—á–∏–≤ –±–æ —Ç–æ–≤–∞—Ä–∏ —Ñ—ñ–≥–Ω—è —Ç–∞–º
     sheetName: '–õ–∏—Å—Ç1', 
     columns: { article: 'B', size: 'C', quantity: 'D', price: 'E', extra: 'A' }
    },
    // { 
    //   id: '18WtrpEbIbryazp8ioGYuf2tSiIwWkrJjO1xp-ePxz-I', //brooklyn copy
    //   sheetName: 'filtered', 
    //   columns: { article: 'A', size: 'B', quantity: 'D', price: 'C', extra: 'E' }
    // },
    {
      id: '1sAlUnv4bO43bJdYe_j8jaAec06yuI4WHacg_pqNIM30', //7dreams copy
      sheetName: 'shoes', 
      columns: { article: 'A', size: 'C', quantity: 'Z', price: 'E', extra: 'B' }
    },
    { 
     id: '1JjTvMglqone8RgXY_FRM2kSRr0WllU2nUTmBoPTVmks', //SPORT_ORIGINAL_UA –û–î–Ø–ì
     sheetName: '–í–ó–£–¢–¢–Ø', 
     columns: { article: 'B', size: 'C', quantity: 'D', price: 'F', extra: 'A' }
    },
    { 
     id: '1JjTvMglqone8RgXY_FRM2kSRr0WllU2nUTmBoPTVmks', //SPORT_ORIGINAL_UA –í–ó–£–¢–¢–Ø
     sheetName: '–û–î–Ø–ì', 
     columns: { article: 'B', size: 'C', quantity: 'D', price: 'F', extra: 'A' }
    },
    { 
     id: '1qN7SpzOtY0qNO2jvs7U5ZeJ3Z3eZmKFP7Cfy5jo5jkU', //SNEAKERIV | Drop
     sheetName: '–î—Ä–æ–ø', 
     columns: { article: 'A', size: 'C', quantity: 'D', price: 'E', extra: 'B' }
   },
   { 
     id: '10N4NzM1FQjP3WgWPwj7DD0B7N7-Y_BZb4vimG95H4oo', //Egoist –î—Ä–æ–ø
     sheetName: '–õ–∏—Å—Ç1', 
     columns: { article: 'B', size: 'D', quantity: 'E', price: 'F', extra: 'A' }
    },
    { 
     id: '175jbwCX_1w3Gv3vklFsWE7KOPikVdlr2GeomXr4gk5M', //–¢–∞–±–ª–∏—Ü—è –¥—Ä–æ–ø Modni. Flow
     sheetName: '–õ–∏—Å—Ç1', 
     columns: { article: 'B', size: 'C', quantity: 'D', price: 'F', extra: 'A' }
   },
    { 
     id: '1nsue3rf6jDT1leMvFO8bA7wsTfnJOBTu5gQMG8u50a8', //duds in ua drop merged
     sheetName: '–ê—Ä–∫—É—à1', 
     columns: { article: 'B', size: 'J', quantity: 'F', price: 'G', extra: 'A' }
    },

    // { 
    //   id: '1iZ5nozOt9RGW9XUqqHsGnC8_jlPXqrmBkPJe3Z-nkNg', //manual ROMME SHOP DROP
    //   sheetName: '–ê—Ä–∫—É—à1', 
    //   columns: { article: 'B', size: 'J', quantity: 'Z', price: 'E', extra: 'A' }
    // },
    // { 
    //   id: '1xIR31bmRK1jNo0FxWSQfIGRu-S7Nwwd2b9FhsILCXrQ', //stacs manual
    //   sheetName: 'filtered', 
    //   columns: { article: 'B', size: 'C', quantity: 'D', price: 'E', extra: 'A'}
    // },
    { 
      id: '1j8R9CqYyPZx_m4c--fPrfmkh1xrYt2dlwyWG4YwkFvw', //SneakerLand –î—Ä–æ–ø copy
      sheetName: 'filtered', 
      columns: { article: 'A', size: 'F', quantity: 'H', price: 'J', extra: 'B'}
    },
    { 
      id: '1-7TwY0ehYqsV-Vr0df8SOcBfWKfH03Ivgoq_dbunS4I', //Copordrop.–î—Ä–æ–ø—à–∏–ø—ñ–Ω–≥
      sheetName: '–û–±—É–≤—å', 
      columns: { article: 'A', size: 'F', quantity: 'H', price: 'J', extra: 'C'}
    },
    // { 
    //   id: '1RXQT_who_tnweX9pIkLqfBFi_R8GYSC8ivztDrQ7n2w', //–î—Ä–æ–ø—à–∏–ø—ñ–Ω–≥ bro.reseller
    //   sheetName: '–¢–æ–≤–∞—Ä–∏', 
    //   columns: { article: 'B', size: 'D', quantity: 'F', price: 'G', extra: 'A'}
    // },
    { 
      id: '1P2rBnke0rjKkCDvyZp_Ihib0QHGh-8xz_rIOBdEZP1U', //–î–†–û–ü Solidniy Shop New
      sheetName: '–ú—É–∂—Å–∫–∞—è –æ–±—É–≤—å', 
      columns: { article: 'A', size: 'D', quantity: 'F', price: 'H', extra: 'B'}
    },
    // { 
    //   id: '1SxG8kfEDdTK2XFq_14oI-di9erGFp_4QWfmjXQl2qM8', //–î—Ä–æ–ø 7TONN
    //   sheetName: '7TONN', 
    //   columns: { article: 'A', size: 'G', quantity: 'H', price: 'I', extra: 'C'}
    // },
    { 
      id: '14L1W-2q0s4DElKpLBl-NDzYzYSB380U5EfDgJOd4lKw', //–î—Ä–æ–ø—à–∏–ø—ñ–Ω–≥ trainers_ua manual
      sheetName: '–õ–∏—Å—Ç1', 
      columns: { article: 'C', size: 'J', quantity: 'G', price: 'F', extra: 'B'}
    },
    { 
      id: '1r_eVxwZRbCefLyOE8ZJvKDALnl-d4RL4pGqC9kyXjxk', //Limited Stay
      sheetName: '–õ–∏—Å—Ç1', 
      columns: { article: 'B', size: 'C', quantity: 'D', price: 'E', extra: 'A'}
    },
    { 
      id: '1ovtpRg6_n9ws1986DBFHcGex9IDhrLjmzLV21Q1dB9w', //–î–†–û–ü SPORTWEAR_DEALER
      sheetName: '–õ–∏—Å—Ç1', 
      columns: { article: 'B', size: 'F', quantity: 'E', price: 'G', extra: 'D'}
    },
    { 
      id: '1Zku_0GSiiBXat7s05JUFeUlP7SeKIEMpBOXYfkfS4BQ', //TCROSS.shop
      sheetName: '–ê—Ä–∫—É—à1', 
      columns: { article: 'A', size: 'D', quantity: 'F', price: 'H', extra: 'B'}
    },
    { 
      id: '1R39R6lc-zA9hHBpzcWgNQ0gF0FRt_t5P4Ns28jnzFY4', //1310
      sheetName: '1310', 
      columns: { article: 'B', size: 'D', quantity: 'H', price: 'G', extra: 'A'}
    },
    { 
      id: '1W6ACzlt_MSb3E6mRbNjiBhKMIux8GD_So1ENPdnwk18', //–î–†–û–ü trainssy
      sheetName: '–õ–∏—Å—Ç1', 
      columns: { article: 'A', size: 'D', quantity: 'F', price: 'I', extra: 'B'}
    },
    { 
      id: '179T7u4T1188N0ZnorripD7mXhb6tw1B7n3dJwWwueUY', //Drop Stock
      sheetName: '–¢–æ–≤–∞—Ä–∏', 
      columns: { article: 'D', size: 'E', quantity: 'H', price: 'I', extra: 'C'}
    },
    { 
      id: '1IqrVWEUDdcuoYGdXtm7ZEUOtdMTViVfcgEuUF9P1w_4', //–î—Ä–æ–ø Dimasik
      sheetName: '–õ–∏—Å—Ç1', 
      columns: { article: 'B', size: 'D', quantity: 'C', price: 'F', extra: 'A'}
    },
    { 
      id: '1enA-UKR91NCy1EjzQ8UmYfPHpxD7Yo07T8dGs-tDXQc', //–î—Ä–æ–ø –¢–∞–±–ª–∏—Ü—è PickUpShoes –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–∂–Ω–∏—Ö 6 –≥–æ–¥–∏–Ω
      sheetName: '–°–∞–π—Ç –û–Ω–æ–≤–ª–µ–Ω–∞ –û—Å–Ω–æ–≤–Ω–∞', 
      columns: { article: 'J', size: 'C', quantity: 'F', price: 'G', extra: 'A'}
    },
    { 
      id: '1LcOCx7iTltLZrhUEJzvywU_ZZtMRKE0KVrA4SVWq8oE', //–º—ñ–π —Å–∫–ª–∞–¥ CRM
      sheetName: '–õ–∏—Å—Ç1', 
      columns: { article: 'B',size: 'X', quantity: 'Z', price: 'G', extra: 'D' }
    }, 
    { 
      id: '1LuC3gg3vLuDHPOVfWDwzUjb4jAY0qY-gVMxtS_qwfKM', //—Ä—É—á–Ω–∏–π —Å–∫–ª–∞–¥
      sheetName: '–ê—Ä–∫—É—à1', 
      columns: { article: 'A', size: 'B', quantity: 'C', price: 'E', extra: 'F' }
    },
    { 
      id: '1PN75brWi57ExzPHT1W1KKxTUB3tdosZ0XC18kZUaOWw', //setka
      sheetName: 'setka_web', 
      columns: { article: 'A', size: 'C', quantity: 'D', price: 'F', extra: 'B' }
    },
    { 
      id: '1LcOCx7iTltLZrhUEJzvywU_ZZtMRKE0KVrA4SVWq8oE', //Supreme Hanes –ø–∞–∫–∏ –∑ —Ç–∞–±–ª–∏—Ü—ñ –º—ñ–π —Å–∫–ª–∞–¥ CRM
      sheetName: 'Drop Hanes', 
      columns: { article: 'N',size: 'O', quantity: 'Z', price: 'P', extra: 'L' }
    },

  ];

  var targetSpreadsheetId = '1ZQwbpvqudO58TOF0UA_bwtj_4GlBbUmQ96NQQ2X4rwA';
  var targetSheetName = '–ê—Ä–∫—É—à1';

  var targetSpreadsheet = SpreadsheetApp.openById(targetSpreadsheetId);
  var targetSheet = targetSpreadsheet.getSheetByName(targetSheetName);

  // –û—á–∏—â–µ–Ω–Ω—è –∞—Ä–∫—É—à—É –ø–µ—Ä–µ–¥ –ø–æ—á–∞—Ç–∫–æ–º —Ä–æ–±–æ—Ç–∏
  targetSheet.clear();

  // –î–æ–¥–∞–≤–∞–Ω–Ω—è –∑–∞–≥–æ–ª–æ–≤–∫—ñ–≤ —É –ø–µ—Ä—à–∏–π —Ä—è–¥–æ–∫
  targetSheet.appendRow(["–ê—Ä—Ç–∏–∫—É–ª", "–†–æ–∑–º—ñ—Ä", "–ö—ñ–ª—å–∫—ñ—Å—Ç—å", "–î—Ä–æ–ø", "–¶—ñ–Ω–∞", "–ù–∞–∑–≤–∞", "–ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫"]);

  var targetRangeStartRow = 2;

  var percentageSheet = targetSpreadsheet.getSheetByName('–ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç—ñ–≤');
  var percentages = {};
  
  // –û—Ç—Ä–∏–º–∞–Ω–Ω—è –Ω–∞—Ü—ñ–Ω–∫–∏ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞ –∑ –∞—Ä–∫—É—à–∞ "–ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç—ñ–≤"
  var percentageData = percentageSheet.getRange(1, 1, percentageSheet.getLastRow(), 2).getValues();
  percentageData.forEach(function(row) {
    var supplier = row[0]; // –ù–∞–∑–≤–∞ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞
    var markup = parseFloat(row[1]); // –ù–∞—Ü—ñ–Ω–∫–∞
    percentages[supplier] = markup || 0; // –Ø–∫—â–æ –Ω–∞—Ü—ñ–Ω–∫–∞ –Ω–µ –≤–∫–∞–∑–∞–Ω–∞, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ 0
  });

  var allData = [];

  configs.forEach(function(config) {
    var sheet = SpreadsheetApp.openById(config.id).getSheetByName(config.sheetName);
    if (!sheet) {
      Logger.log('–õ–∏—Å—Ç –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ: ' + config.sheetName + ' —É —Ç–∞–±–ª–∏—Ü—ñ ' + config.id);
      return;
    }

    var lastRow = sheet.getLastRow();
    var data = sheet.getDataRange().getValues();

    var articleIndex = config.columns.article.charCodeAt(0) - 65;
    var sizeIndex = config.columns.size.charCodeAt(0) - 65;
    var quantityIndex = config.columns.quantity.charCodeAt(0) - 65;
    var priceIndex = config.columns.price.charCodeAt(0) - 65;
    var extraIndex = config.columns.extra ? config.columns.extra.charCodeAt(0) - 65 : null;

    var fileName = DriveApp.getFileById(config.id).getName();
    var supplierMarkup = percentages[fileName] || 0; // –û—Ç—Ä–∏–º—É—î–º–æ –Ω–∞—Ü—ñ–Ω–∫—É –¥–ª—è –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞ –∞–±–æ 0
for (var i = 1; i < lastRow; i++) {
  var article = data[i][articleIndex] || '';
  var size = data[i][sizeIndex] || '';
  var rawQuantity = data[i][quantityIndex];
  var price = parseFloat(data[i][priceIndex]) || 0;

  // ‚ùó –ü—Ä–æ–ø—É—Å–∫–∞—î–º–æ —Ç–æ–≤–∞—Ä–∏ –±–µ–∑ —Ü—ñ–Ω–∏
  if (!price || price === 0 || isNaN(price)) {
    continue;
  }

  // –Ø–∫—â–æ 0 ‚Üí –ø—Ä–æ–ø—É—Å–∫–∞—î–º–æ —Ç–æ–≤–∞—Ä
  if (rawQuantity === 0 || rawQuantity === "0") {
    continue;
  }

  // –Ø–∫—â–æ –ø—É—Å—Ç–æ ‚Üí —Å—Ç–∞–≤–∏–º–æ 1
  var quantity = rawQuantity === "" ? 1 : parseInt(rawQuantity, 10);

  if (supplierMarkup === 0) {
    var pricePlusPercentage = price;
  } else {
    var pricePlusPercentage = price * (1 + supplierMarkup / 100);
    // –î–æ–¥–∞—î–º–æ 500 –≥—Ä–Ω —è–∫—â–æ –º–∞—Ä–∂–∞ –º–µ–Ω—à–∞ 500
    if (pricePlusPercentage - price < 500) {
      pricePlusPercentage = price + 500;
    }
  }

  // –û–∫—Ä—É–≥–ª—é—î–º–æ —Ü—ñ–Ω—É –¥–æ –Ω–∞–π–±–ª–∏–∂—á–æ–≥–æ –∫—Ä–∞—Ç–Ω–æ–≥–æ 10
  var roundedPrice = Math.ceil(pricePlusPercentage / 10) * 10;

  var extra = extraIndex !== null ? data[i][extraIndex] || '' : '';

  if (size.toString().includes(',')) {
    size = size.toString().replace(/\,/g, '.');
  }

  var newRow = [
    article,
    size,
    quantity,
    parseFloat(price.toFixed(2)),
    parseFloat(roundedPrice.toFixed(2)),
    extra,
    fileName
  ];

  allData.push(newRow);
}

  });

  if (allData.length > 0) {
    var targetRange = targetSheet.getRange(targetRangeStartRow, 1, allData.length, 7);
    targetRange.setValues(allData);
  } else {
    Logger.log('–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏');
  } // –í–∏–∫–ª–∏–∫ –¥—Ä—É–≥–æ—ó —Ñ—É–Ω–∫—Ü—ñ—ó –ø—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–¥—É
  removeDuplicatesWithMinPriceAndPriority();
  
  Logger.log("–í–∏–∫–ª–∏–∫ –¥—Ä—É–≥–æ—ó —Ñ—É–Ω–∫—Ü—ñ—ó —É—Å–ø—ñ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–æ");
}

function removeDuplicatesWithMinPriceAndPriority() {
  // –í–≤–µ–¥—ñ—Ç—å —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä —Ç–∞–±–ª–∏—Ü—ñ (spreadsheet ID) —Ç–∞ –Ω–∞–∑–≤—É –ª–∏—Å—Ç–∞ (sheet name) —Ç—É—Ç
  var spreadsheetId = '1ZQwbpvqudO58TOF0UA_bwtj_4GlBbUmQ96NQQ2X4rwA'; // –ó–∞–º—ñ–Ω—ñ—Ç—å –Ω–∞ –≤–∞—à ID —Ç–∞–±–ª–∏—Ü—ñ
  var sheetName = '–ê—Ä–∫—É—à1'; // –ó–∞–º—ñ–Ω—ñ—Ç—å –Ω–∞ –Ω–∞–∑–≤—É –≤–∞—à–æ–≥–æ –ª–∏—Å—Ç–∞

  // –û—Ç—Ä–∏–º—É—î–º–æ —Ç–∞–±–ª–∏—Ü—é —ñ –ª–∏—Å—Ç
  var spreadsheet = SpreadsheetApp.openById(spreadsheetId);
  var sheet = spreadsheet.getSheetByName(sheetName);

  if (!sheet) {
    Logger.log('–õ–∏—Å—Ç –∑ –Ω–∞–∑–≤–æ—é "' + sheetName + '" –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.');
    return;
  }

  // –û—Ç—Ä–∏–º—É—î–º–æ –≤—Å—ñ –¥–∞–Ω—ñ –∑ –∞—Ä–∫—É—à–∞
  var data = sheet.getDataRange().getValues();
  var header = data[0]; // –ó–∞–≥–æ–ª–æ–≤–∫–∏
  data.shift(); // –í–∏–¥–∞–ª—è—î–º–æ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è –æ–±—Ä–æ–±–∫–∏ –ª–∏—à–µ –¥–∞–Ω–∏—Ö

  // –û–±'—î–∫—Ç –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —É–Ω—ñ–∫–∞–ª—å–Ω–∏—Ö –∞—Ä—Ç–∏–∫—É–ª—ñ–≤+—Ä–æ–∑–º—ñ—Ä—ñ–≤ –∑ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–æ—é —Ü—ñ–Ω–æ—é
  var uniqueArticles = {};
  
  // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ —Ä—ñ–≤–Ω—ñ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç—É –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫—ñ–≤
  var highPrioritySuppliers = ['–†—É—á–Ω–∏–π —Å–∫–ª–∞–¥']; // –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç 1 (–Ω–∞–π–≤–∏—â–∏–π)'–º—ñ–π —Å–∫–ª–∞–¥ –∑ CRM'
  var mediumPrioritySuppliers = ['–º—ñ–π —Å–∫–ª–∞–¥ –∑ CRM']; // –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç 2 (—Å–µ—Ä–µ–¥–Ω—ñ–π)
  
  
  data.forEach(function(row) {
    var article = row[0]; // –ê—Ä—Ç–∏–∫—É–ª
    var size = row[1]; // –†–æ–∑–º—ñ—Ä
    var key = article + '_' + size; // –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π –∫–ª—é—á: –∞—Ä—Ç–∏–∫—É–ª+—Ä–æ–∑–º—ñ—Ä
    var price = parseFloat(row[4]); // –¶—ñ–Ω–∞
    var supplier = row[6]; // –ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫

    if (!uniqueArticles[key]) {
      uniqueArticles[key] = row; // –î–æ–¥–∞—î–º–æ –Ω–æ–≤–∏–π –∞—Ä—Ç–∏–∫—É–ª+—Ä–æ–∑–º—ñ—Ä
    } else {
      var existingRow = uniqueArticles[key];
      var existingPrice = parseFloat(existingRow[4]);
      var existingSupplier = existingRow[6];
      
      // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç—É –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞
      function getSupplierPriority(supplier) {
        if (highPrioritySuppliers.indexOf(supplier) > -1) {
          return 1; // –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç 1
        } else if (mediumPrioritySuppliers.indexOf(supplier) > -1) {
          return 2; // –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç 2
        } else {
          return 3; // –Ü–Ω—à—ñ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∏
        }
      }

      var currentSupplierPriority = getSupplierPriority(supplier);
      var existingSupplierPriority = getSupplierPriority(existingSupplier);

      if (currentSupplierPriority < existingSupplierPriority) {
        // –û–Ω–æ–≤–ª—é—î–º–æ, —è–∫—â–æ –ø–æ—Ç–æ—á–Ω–∏–π –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫ –º–∞—î –≤–∏—â–∏–π –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç
        uniqueArticles[key] = row;
      } else if (currentSupplierPriority === existingSupplierPriority) {
        // –Ø–∫—â–æ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∏ –º–∞—é—Ç—å –æ–¥–Ω–∞–∫–æ–≤–∏–π –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç, –ø–æ—Ä—ñ–≤–Ω—é—î–º–æ –∑–∞ —Ü—ñ–Ω–æ—é
        if (price < existingPrice) {
          uniqueArticles[key] = row; // –û–Ω–æ–≤–ª—é—î–º–æ, —è–∫—â–æ –ø–æ—Ç–æ—á–Ω–∞ —Ü—ñ–Ω–∞ –º–µ–Ω—à–∞
        }
      }
    }
  });

  // –§–æ—Ä–º—É—î–º–æ –º–∞—Å–∏–≤ –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –∑ —É–Ω—ñ–∫–∞–ª—å–Ω–∏–º–∏ –∞—Ä—Ç–∏–∫—É–ª—å–Ω–∏–º–∏ —Ä—è–¥–∫–∞–º–∏
  var newData = [header]; // –î–æ–¥–∞—î–º–æ –∑–∞–≥–æ–ª–æ–≤–∫–∏
  for (var key in uniqueArticles) {
    newData.push(uniqueArticles[key]);
  } // –°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è –ø–æ –∞—Ä—Ç–∏–∫—É–ª—É (–∫–æ–ª–æ–Ω–∫–∞ 0)
  newData.sort(function(a, b) {
    return String(a[0]).localeCompare(String(b[0])); // –ü—Ä–∏–≤–æ–¥–∏–º–æ –∞—Ä—Ç–∏–∫—É–ª –¥–æ —Ä—è–¥–∫–∞ –¥–ª—è –∫–æ—Ä–µ–∫—Ç–Ω–æ–≥–æ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è
  });

  // –û—á–∏—â–∞—î–º–æ –∞—Ä–∫—É—à —ñ –≤—Å—Ç–∞–≤–ª—è—î–º–æ —É–Ω—ñ–∫–∞–ª—å–Ω—ñ –¥–∞–Ω—ñ
  sheet.clear();
  sheet.getRange(1, 1, newData.length, newData[0].length).setValues(newData);
}
function removeDuplicatesWithMinPriceAndPriority() {
  // –í–≤–µ–¥—ñ—Ç—å —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä —Ç–∞–±–ª–∏—Ü—ñ (spreadsheet ID) —Ç–∞ –Ω–∞–∑–≤—É –ª–∏—Å—Ç–∞ (sheet name) —Ç—É—Ç
  var spreadsheetId = '1ZQwbpvqudO58TOF0UA_bwtj_4GlBbUmQ96NQQ2X4rwA'; // –ó–∞–º—ñ–Ω—ñ—Ç—å –Ω–∞ –≤–∞—à ID —Ç–∞–±–ª–∏—Ü—ñ
  var sheetName = '–ê—Ä–∫—É—à1'; // –ó–∞–º—ñ–Ω—ñ—Ç—å –Ω–∞ –Ω–∞–∑–≤—É –≤–∞—à–æ–≥–æ –ª–∏—Å—Ç–∞

  // –û—Ç—Ä–∏–º—É—î–º–æ —Ç–∞–±–ª–∏—Ü—é —ñ –ª–∏—Å—Ç
  var spreadsheet = SpreadsheetApp.openById(spreadsheetId);
  var sheet = spreadsheet.getSheetByName(sheetName);

   if (!sheet) {
    Logger.log('–õ–∏—Å—Ç –∑ –Ω–∞–∑–≤–æ—é "' + sheetName + '" –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.');
    return;
  }

  // –û—Ç—Ä–∏–º—É—î–º–æ –≤—Å—ñ –¥–∞–Ω—ñ –∑ –∞—Ä–∫—É—à–∞
  var data = sheet.getDataRange().getValues();
  var header = data[0]; // –ó–∞–≥–æ–ª–æ–≤–∫–∏
  data.shift(); // –í–∏–¥–∞–ª—è—î–º–æ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è –æ–±—Ä–æ–±–∫–∏ –ª–∏—à–µ –¥–∞–Ω–∏—Ö

  // –û–±'—î–∫—Ç –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —É–Ω—ñ–∫–∞–ª—å–Ω–∏—Ö –∞—Ä—Ç–∏–∫—É–ª—ñ–≤+—Ä–æ–∑–º—ñ—Ä—ñ–≤ –∑ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–æ—é —Ü—ñ–Ω–æ—é
  var uniqueArticles = {};

  data.forEach(function(row) {
    var article = row[0]; // –ê—Ä—Ç–∏–∫—É–ª
    var size = row[1]; // –†–æ–∑–º—ñ—Ä
    var key = article + '_' + size; // –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π –∫–ª—é—á: –∞—Ä—Ç–∏–∫—É–ª+—Ä–æ–∑–º—ñ—Ä
    var price = parseFloat(row[4]); // –¶—ñ–Ω–∞
    var supplier = row[6]; // –ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫

    if (!uniqueArticles[key]) {
      uniqueArticles[key] = row; // –î–æ–¥–∞—î–º–æ –Ω–æ–≤–∏–π –∞—Ä—Ç–∏–∫—É–ª+—Ä–æ–∑–º—ñ—Ä
    } else {
      var existingRow = uniqueArticles[key];
      var existingPrice = parseFloat(existingRow[4]);

      // –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è —Ü—ñ–Ω–∏ —Ç–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è, —è–∫—â–æ –∑–Ω–∞–π–¥–µ–Ω–æ –Ω–∏–∂—á—É —Ü—ñ–Ω—É
      if (price < existingPrice) {
        uniqueArticles[key] = row; // –û–Ω–æ–≤–ª—é—î–º–æ, —è–∫—â–æ –ø–æ—Ç–æ—á–Ω–∞ —Ü—ñ–Ω–∞ –º–µ–Ω—à–∞
      } else if (price === existingPrice) {
        // –í–∏–±—ñ—Ä –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞ –∑–∞ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–æ–º (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ)
        var prioritySuppliers = ['supplier1', 'supplier2']; // –î–æ–¥–∞–π—Ç–µ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫—ñ–≤ –∑ –≤–∏—â–∏–º –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–æ–º
        if (prioritySuppliers.indexOf(supplier) > -1 && prioritySuppliers.indexOf(existingRow[6]) === -1) {
          uniqueArticles[key] = row; // –û–Ω–æ–≤–ª—é—î–º–æ, —è–∫—â–æ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫ –≤ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç—ñ
        }
      }
    }
  });

  // –§–æ—Ä–º—É—î–º–æ –º–∞—Å–∏–≤ –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –∑ —É–Ω—ñ–∫–∞–ª—å–Ω–∏–º–∏ –∞—Ä—Ç–∏–∫—É–ª—å–Ω–∏–º–∏ —Ä—è–¥–∫–∞–º–∏
  var newData = [header]; // –î–æ–¥–∞—î–º–æ –∑–∞–≥–æ–ª–æ–≤–∫–∏
  for (var key in uniqueArticles) {
    newData.push(uniqueArticles[key]);
  }

  // –û—á–∏—â–∞—î–º–æ –∞—Ä–∫—É—à —ñ –≤—Å—Ç–∞–≤–ª—è—î–º–æ —É–Ω—ñ–∫–∞–ª—å–Ω—ñ –¥–∞–Ω—ñ
  sheet.clear();
  sheet.getRange(1, 1, newData.length, newData[0].length).setValues(newData);
}
function deleteRowsWithKeywords() {
  // –í–∏–∑–Ω–∞—á—Ç–µ ID –≤–∞—à–æ—ó —Ç–∞–±–ª–∏—Ü—ñ —Ç–∞ –Ω–∞–∑–≤—É –ª–∏—Å—Ç–∞
  var spreadsheetId = '1ZQwbpvqudO58TOF0UA_bwtj_4GlBbUmQ96NQQ2X4rwA'; // –ó–∞–º—ñ–Ω—ñ—Ç—å –Ω–∞ ID –≤–∞—à–æ–≥–æ Google Sheets –¥–æ–∫—É–º–µ–Ω—Ç–∞
  var sheetName = '–ê—Ä–∫—É—à1'; // –ó–∞–º—ñ–Ω—ñ—Ç—å –Ω–∞ –Ω–∞–∑–≤—É –≤–∞—à–æ–≥–æ –ª–∏—Å—Ç–∞
  var logSheetName = '–ñ—É—Ä–Ω–∞–ª'; // –ù–∞–∑–≤–∞ –ª–∏—Å—Ç–∞ –¥–ª—è –∑–∞–ø–∏—Å—É –æ–±—Ä–æ–±–ª–µ–Ω–∏—Ö —Å–ª—ñ–≤
  var statusSheetName = '–ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç—ñ–≤'; // –ù–∞–∑–≤–∞ –ª–∏—Å—Ç–∞ –¥–ª—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è

  // –ö–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞ –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è
  var keywords = [
    '–¢–∞–±–ª–µ—Ç–∫–∏', '–ö–∞–ø—Å—É–ª–∏', '–ü–æ—Ä–æ—à–æ–∫', '–ë–∞—Ç–æ–Ω—á–∏–∫', '–†—ñ–¥–∏–Ω–∞', '–®–µ–π–∫–µ—Ä', '–°–æ—Ñ—Ç', '–¢—Ä—ñ–∫–æ', '–ü–ª–∞–≤–∫–∏',
    '–ë—É—Ç—Å–∏', '–°–æ—Ä–æ–∫–æ–Ω—ñ–∂–∫–∏', 'Arena', 'CMP', 'Saucony', 'Rains', 'Falke', 'Under Armour',
    'Helly', 'Skechers', '47 Brand', 'New Era', 'PIAZZA', 'GFA', 'CAPSLAB', 'Eastpak',
    'Lyle & Scott', 'AUSTRALIAN ESSENTIALS', 'JEEP', 'Ellesse'
  ];

  // –í—ñ–¥–∫—Ä–∏—Ç—Ç—è —Ç–∞–±–ª–∏—Ü—ñ —Ç–∞ –ª–∏—Å—Ç–∞
  var spreadsheet = SpreadsheetApp.openById(spreadsheetId);
  var sheet = spreadsheet.getSheetByName(sheetName);
  
  // –í—ñ–¥–∫—Ä–∏—Ç—Ç—è –∞–±–æ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ª–∏—Å—Ç–∞ –¥–ª—è –∂—É—Ä–Ω–∞–ª—É
  var logSheet = spreadsheet.getSheetByName(logSheetName);
  if (!logSheet) {
    logSheet = spreadsheet.insertSheet(logSheetName);
  }

  // –í—ñ–¥–∫—Ä–∏—Ç—Ç—è –∞–±–æ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ª–∏—Å—Ç–∞ –¥–ª—è —Å—Ç–∞—Ç—É—Å—É
  var statusSheet = spreadsheet.getSheetByName(statusSheetName);
  if (!statusSheet) {
    statusSheet = spreadsheet.insertSheet(statusSheetName);
  }

  // –û—Ç—Ä–∏–º–∞–Ω–Ω—è –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –æ–±—Ä–æ–±–ª–µ–Ω–æ–≥–æ –∫–ª—é—á–æ–≤–æ–≥–æ —Å–ª–æ–≤–∞
  var lastRow = logSheet.getLastRow();
  var lastKeyword = lastRow > 0 ? logSheet.getRange(lastRow, 1).getValue() : null;

  // –ó–Ω–∞—Ö–æ–¥–∏–º–æ —ñ–Ω–¥–µ–∫—Å –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –æ–±—Ä–æ–±–ª–µ–Ω–æ–≥–æ —Å–ª–æ–≤–∞
  var startIndex = 0;
  if (lastKeyword) {
    startIndex = keywords.indexOf(lastKeyword);
  }

  // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏ —î —â–æ –æ–±—Ä–æ–±–ª—è—Ç–∏ –ø—ñ—Å–ª—è –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –∫–ª—é—á–æ–≤–æ–≥–æ —Å–ª–æ–≤–∞
  if (startIndex < 0 || startIndex >= keywords.length) {
    Logger.log('–£—Å—ñ –∫–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞ –≤–∂–µ –æ–±—Ä–æ–±–ª–µ–Ω—ñ –∞–±–æ —Å–ª–æ–≤–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –≤ —Å–ø–∏—Å–∫—É.');
    
    // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—É –ø—Ä–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –æ–±—Ä–æ–±–∫–∏
    statusSheet.getRange('C2').setValue('–§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—é –∑–∞–≤–µ—Ä—à–µ–Ω–æ');
    return;
  }

  // –ü—Ä–æ—Ö–æ–¥–∏–º–æ —á–µ—Ä–µ–∑ –∫–æ–∂–Ω–µ –∫–ª—é—á–æ–≤–µ —Å–ª–æ–≤–æ, –ø–æ—á–∏–Ω–∞—é—á–∏ –∑ –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –æ–±—Ä–æ–±–ª–µ–Ω–æ–≥–æ
  for (var k = startIndex; k < keywords.length; k++) {
    // –û—Ç—Ä–∏–º–∞–Ω–Ω—è –≤—Å—å–æ–≥–æ –¥—ñ–∞–ø–∞–∑–æ–Ω—É –¥–∞–Ω–∏—Ö
    var lastRow = sheet.getLastRow();
    var lastColumn = sheet.getLastColumn();
    if (lastRow < 1) continue; // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞, —â–æ —î —Ä—è–¥–∫–∏ –¥–ª—è –æ–±—Ä–æ–±–∫–∏

    var range = sheet.getRange(1, 1, lastRow, lastColumn);

    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ —Ñ—ñ–ª—å—Ç—Ä—É
    var filter = range.getFilter();
    if (!filter) {
      range.createFilter();
      filter = range.getFilter();
    }

    // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ñ—ñ–ª—å—Ç—Ä—É –¥–ª—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–ª—é—á–æ–≤–æ–≥–æ —Å–ª–æ–≤–∞
    var filterCriteria = SpreadsheetApp.newFilterCriteria().whenTextContains(keywords[k]).build();
    filter.setColumnFilterCriteria(6, filterCriteria); // 6 - —Ü–µ –∫–æ–ª–æ–Ω–∫–∞ F

    // –í–∏–¥–∞–ª–µ–Ω–Ω—è –≤—Å—ñ—Ö –≤—ñ–¥—Ñ—ñ–ª—å—Ç—Ä–æ–≤–∞–Ω–∏—Ö —Ä—è–¥–∫—ñ–≤ (—è–∫ Ctrl+Shift+Down+Delete)
    var filteredRange = sheet.getDataRange();
    var filteredValues = filteredRange.getValues();

    for (var i = filteredValues.length - 1; i >= 0; i--) {
      if (filteredValues[i][5] && filteredValues[i][5].toString().indexOf(keywords[k]) !== -1) {
        sheet.deleteRow(i + 1); // –í–∏–¥–∞–ª–µ–Ω–Ω—è —Ä—è–¥–∫–∞
      }
    }

    // –ó–Ω—è—Ç—Ç—è —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó
    filter.remove();

    // –ó–∞–ø–∏—Å—É—î–º–æ –æ–±—Ä–æ–±–ª–µ–Ω–µ —Å–ª–æ–≤–æ —É –∂—É—Ä–Ω–∞–ª
    logSheet.appendRow([keywords[k]]);
  }

  // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—É –ø—Ä–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –æ–±—Ä–æ–±–∫–∏
  statusSheet.getRange('C2').setValue('–§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—é –∑–∞–≤–µ—Ä—à–µ–Ω–æ');
}

function clearSheet() {
  // –£–∫–∞–∂–∏—Ç–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–∞–±–ª–∏—Ü—ã (Spreadsheet ID)
  var spreadsheetId = '1ZQwbpvqudO58TOF0UA_bwtj_4GlBbUmQ96NQQ2X4rwA';

  // –£–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ª–∏—Å—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å
  var sheetName = '–ê—Ä–∫—É—à1';
  var logSheetName = '–ñ—É—Ä–Ω–∞–ª';

  // –û—Ç–∫—Ä—ã–≤–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –ø–æ –µ—ë –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—É
  var spreadsheet = SpreadsheetApp.openById(spreadsheetId);

  // –ü–æ–ª—É—á–∞–µ–º –ª–∏—Å—Ç –ø–æ –µ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏—é
  var sheet = spreadsheet.getSheetByName(sheetName);
  var logSheet = spreadsheet.getSheetByName(logSheetName);

  // –û—á–∏—â–∞–µ–º –ª–∏—Å—Ç '–ê—Ä–∫—É—à1'
  if (sheet) {
    sheet.clear();
    Logger.log('–õ–∏—Å—Ç "' + sheetName + '" —É—Å–ø–µ—à–Ω–æ –æ—á–∏—â–µ–Ω.');
  } else {
    Logger.log('–õ–∏—Å—Ç —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º "' + sheetName + '" –Ω–µ –Ω–∞–π–¥–µ–Ω.');
  }

  // –û—á–∏—â–∞–µ–º –ª–∏—Å—Ç '–Ñ–∂—É—Ä–Ω–∞–ª–Ñ'
  if (logSheet) {
    logSheet.clear();
    Logger.log('–õ–∏—Å—Ç "' + logSheetName + '" —É—Å–ø–µ—à–Ω–æ –æ—á–∏—â–µ–Ω.');
  } else {
    Logger.log('–õ–∏—Å—Ç —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º "' + logSheetName + '" –Ω–µ –Ω–∞–π–¥–µ–Ω.');
  }
}

const DATA_SHEET_NAME = "Stock";
const ss = SpreadsheetApp.getActiveSpreadsheet();


const configSheet = ss.getSheetByName("Config");
const dataSheet = ss.getSheetByName(DATA_SHEET_NAME);

const configData = configSheet.getDataRange().getValues();
const currentData = dataSheet.getDataRange().getValues();


const configMap = configData.reduce((map, row) => {
  map[row[0]] = row[1] - 1;
  return map;
}, {});
const sku_idx = configMap["article"];


function sendPostRequest(url, payload, maxRetries = 10) {
  const options = {
    method: 'post',
    contentType: 'application/json',
    payload: JSON.stringify(payload),
  };

  let attempt = 0;
  let response;
  while (attempt < maxRetries) {
    try {
      response = UrlFetchApp.fetch(url, options);
      return JSON.parse(response.getContentText());
    } catch (error) {
      attempt++;
      console.warn(`–°–ø—Ä–æ–±–∞ ${attempt} –Ω–∞ ${url} –Ω–µ –≤–¥–∞–ª–∞—Å—è: ${error.message}`);

      if (attempt >= maxRetries) {
        throw new Error(`–ó–∞–ø–∏—Ç –Ω–∞ ${url} –Ω–µ –≤–¥–∞–≤—Å—è –ø—ñ—Å–ª—è ${maxRetries} —Å–ø—Ä–æ–±. –ü–æ–º–∏–ª–∫–∞: ${error.message}`);
      }
      Utilities.sleep(1000);
    }
  }
}


// –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ —á–∞—Ç–≥–ø—Ç-----------
function checkForChanges() {
  const numRows = dataSheet.getLastRow(); // –û—Ç—Ä–∏–º—É—î–º–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–ø–æ–≤–Ω–µ–Ω–∏—Ö —Ä—è–¥–∫—ñ–≤

  if (numRows < 10) {
    console.warn("–ê—Ä–∫—É—à1 –ø–æ—Ä–æ–∂–Ω—ñ–π –∞–±–æ –º—ñ—Å—Ç–∏—Ç—å –º–µ–Ω—à–µ 10 –∑–∞–ø–æ–≤–Ω–µ–Ω–∏—Ö —Ä—è–¥–∫—ñ–≤. –°–∫—Ä–∏–ø—Ç –Ω–µ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è.");
    return;
  }
  applyChanges(currentData);
}
// –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ —á–∞—Ç–≥–ø—Ç-----------


function exportProductsSKUs(token) {
  let fullData = [];
  let offset = 0;
  const lim = 500;

  while (true) {
    const data = sendPostRequest(`${domain}/api/catalog/export/`, {
      "token": token,
      "offset": offset * lim,
      "limit": lim
    }).response.products;

    fullData = [...fullData, ...data];
    if (data.length < lim) break;
    offset++;
  }

  Logger.log(fullData);
  return fullData.map(value => [value.article, value.supplier.value, value.presence.value?.ua, value.display_in_showcase, value.parent_article, value.price]);

}


function importProducts(products, token) {

  const chunkSize = 500;

  for (let i = 0; i < products.length; i += chunkSize) {
    const productChunk = products.slice(i, i + chunkSize);
    sendPostRequest(`${domain}/api/catalog/import/`, {
      "token": token,
      "products": productChunk,
    });
  }
}

function getPostachMap() {
  const sheet = SpreadsheetApp.getActive().getSheetByName("–•–æ—Ä–æ—à–æ–ø");
  const values = sheet.getDataRange().getValues();

  const postachMap = {};

  // –ü—Ä–æ–ø—É—Å–∫–∞—î–º–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ (i = 1)
  for (let i = 1; i < values.length; i++) {
    const article = values[i][0];      // "–ê—Ä—Ç–∏–∫—É–ª" ‚Äî —Å—Ç–æ–≤–ø–µ—Ü—å A
    const supplier = values[i][1];     // "–ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫" ‚Äî —Å—Ç–æ–≤–ø–µ—Ü—å B
    if (article) {
      postachMap[article] = supplier;
    }
  }
  Logger.log(postachMap);
  return postachMap;
}



function applyChanges(data) {
  const token = sendPostRequest(`${domain}/api/auth/`, {
    "login": login,
    "password": password,
  }).response.token;


  const postachMap = getPostachMap();   // –î–æ–¥–∞–Ω–æ 14.08.2025 - –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –∑—ñ Stock —Ç—Ä–µ–±–∞ —Ç–µ–∂ –ª–∏—à–µ –¥–ª—è drop
  const forRequest = data
    .map(arr => {
      const article = arr[configMap["article"]];

      // –ü—Ä–æ–ø—É—Å–∫–∞—î–º–æ, —è–∫—â–æ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫ –Ω–µ "drop"
      if (postachMap[article] !== "drop") {
        return null;
      }

      const product = {
        "presence": { "ua": "–í –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ" },
        "display_in_showcase": true
      };

      for (const param in configMap) {
        if (!arr[configMap[param]]) continue;
        product[param] = arr[configMap[param]];
      }
      return product;
    })
    .filter(p => p !== null); // –í–∏–¥–∞–ª—è—î–º–æ null


  /*
    // –§–æ—Ä–º—É—î–º–æ forRequest –∑ –¥–∞–Ω–∏—Ö –∑ Google –¢–∞–±–ª–∏—Ü—ñ
    const forRequest = data.map(arr => {
      const product = { "presence": { "ua": "–í –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ" }, "display_in_showcase": true };
      for (const param in configMap) {
        if (!arr[configMap[param]]) continue;
        product[param] = arr[configMap[param]];
      }
      return product;
    });
  */

  /*   –ó–ê–ú–Ü–ù–ï–ù–û –ù–ê –ó–ß–ò–¢–£–í–ê–ù–ù–Ø –ü–û–¢–û–ß–ù–û–ì–û –°–¢–ê–ù–£ –¢–û–í–ê–†–Ü–í –Ü–ó –ê–†–ö–£–®–£ "–•–æ—Ä–æ—à–æ–ø"
    // –û—Ç—Ä–∏–º—É—î–º–æ –≤—Å—ñ —Ç–æ–≤–∞—Ä–∏ –∑ –º–∞–≥–∞–∑–∏–Ω—É
    const skus = exportProductsSKUs(token);
  
    // –ü–µ—Ä–µ—Ç–≤–æ—Ä—é—î–º–æ skus —É –º–∞—Å–∏–≤ –æ–±'—î–∫—Ç—ñ–≤
    const formattedSkus = skus.map(sku => ({
      article: sku[0], // –ê—Ä—Ç–∏–∫—É–ª
      supplier: { value: sku[1] || null }, // –ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫
      presence: { ua: sku[2] }, // –ù–∞—è–≤–Ω—ñ—Å—Ç—å
      display_in_showcase: sku[3], // –°—Ç–∞—Ç—É—Å –ø–æ–∫–∞–∑—É
      parent_article: sku[4] // –ë–∞—Ç—å–∫—ñ–≤—Å—å–∫–∏–π –∞—Ä—Ç–∏–∫—É–ª
    }));
   */

  const formattedSkus = getProductsFromMirrorSheet();
  // –°—Ç–≤–æ—Ä—é—î–º–æ –º–∞—Å–∏–≤ skus —ñ–∑ formattedSkus ‚Äî –¥–ª—è —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ –∑—ñ —Å—Ç–∞—Ä–æ—é –ª–æ–≥—ñ–∫–æ—é
  const skus = formattedSkus.map(p => [
    p.article,
    p.supplier?.value || "",
    p.presence?.ua || "",
    p.display_in_showcase,
    p.parent_article || ""
  ]);

  // –í–∏–∑–Ω–∞—á–∞—î–º–æ —Ç–æ–≤–∞—Ä–∏, –≤—Å—ñ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—ó —è–∫–∏—Ö –≤—ñ–¥—Å—É—Ç–Ω—ñ –≤ —Ç–∞–±–ª–∏—Ü—ñ
  const hiddenProducts = getHiddenProducts(formattedSkus, data);

  // –§–æ—Ä–º—É—î–º–æ skusForShow –¥–ª—è –ø–æ–∫–∞–∑—É –æ–¥–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä—É –∑ –≥—Ä—É–ø–∏
  const skusForShow = hiddenProducts.map(sku => {
    // –ó–Ω–∞—Ö–æ–¥–∏–º–æ –ø–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω —Ç–æ–≤–∞—Ä—É
    const currentProduct = formattedSkus.find(product => product.article === sku);
    // –Ø–∫—â–æ —Ç–æ–≤–∞—Ä —É–∂–µ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è, –Ω–µ –∑–º—ñ–Ω—é—î–º–æ –π–æ–≥–æ —Å—Ç–∞—Ç—É—Å
    if (currentProduct && currentProduct.display_in_showcase === 1.0) {
      return null; // –ü—Ä–æ–ø—É—Å–∫–∞—î–º–æ —Ü–µ–π —Ç–æ–≤–∞—Ä
    }
    // –Ü–Ω–∞–∫—à–µ –¥–æ–¥–∞—î–º–æ –π–æ–≥–æ –¥–æ skusForShow
    return {
      article: sku,
      display_in_showcase: true,
      presence: { ua: "–ù–µ–º–∞—î –≤ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ" },
    };
  }).filter(product => product !== null); // –í–∏–¥–∞–ª—è—î–º–æ null –∑ –º–∞—Å–∏–≤—É
  //  Logger.log(skusForShow);

  // –§–æ—Ä–º—É—î–º–æ skusForChange –¥–ª—è –ø—Ä–∏—Ö–æ–≤–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—ñ–≤, —è–∫–∏—Ö –Ω–µ–º–∞—î –≤ —Ç–∞–±–ª–∏—Ü—ñ
  const skusForChange = skus.flatMap(sku => {                                              //   <--
    // –Ø–∫—â–æ —Ç–æ–≤–∞—Ä –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ skusForShow, –ø—Ä–æ–ø—É—Å–∫–∞—î–º–æ –π–æ–≥–æ
    if (hiddenProducts.includes(sku[0])) {
      return [];
    }

    const skuExists = currentData.some(row => row[sku_idx] === sku[0]);
    if (!skuExists && sku[1] === "drop") {
      // –ó–Ω–∞—Ö–æ–¥–∏–º–æ –ø–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω —Ç–æ–≤–∞—Ä—É
      const currentProduct = formattedSkus.find(product => product.article === sku[0]);
      // –Ø–∫—â–æ —Ç–æ–≤–∞—Ä —É–∂–µ –ø—Ä–∏—Ö–æ–≤–∞–Ω–∏–π, –Ω–µ –∑–º—ñ–Ω—é—î–º–æ –π–æ–≥–æ —Å—Ç–∞—Ç—É—Å
      if ( // if (currentProduct && currentProduct.display_in_showcase === 0.0)  –∑–∞–º—ñ–Ω–µ–Ω–æ 30.09.2025 (–¥–∏–≤ —Å–º—Å)
        currentProduct &&
        currentProduct.display_in_showcase === 0.0 &&
        currentProduct.presence?.ua === "–ù–µ–º–∞—î –≤ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ"
      ) {
        return null; // –ü—Ä–æ–ø—É—Å–∫–∞—î–º–æ —Ü–µ–π —Ç–æ–≤–∞—Ä
      }
      // –Ü–Ω–∞–∫—à–µ –¥–æ–¥–∞—î–º–æ –π–æ–≥–æ –¥–æ skusForChange
      return {
        "article": sku[0],
        "display_in_showcase": false,
        "presence": { "ua": "–ù–µ–º–∞—î –≤ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ" } // "presence": { "ua": "–í –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ" } –∑–∞–º—ñ–Ω–µ–Ω–æ 30.09.2025 (–¥–∏–≤ —Å–º—Å)
      };
    }
    return [];
  }).filter(product => product !== null); // –í–∏–¥–∞–ª—è—î–º–æ null –∑ –º–∞—Å–∏–≤—É

  // –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –≤—Å—ñ –∑–º—ñ–Ω–∏
  if (skusForChange.length || forRequest.length || skusForShow.length) {

    //  Logger.log(saveDataToFile(skusForChange, 'skusForChange.txt'));
    //  Logger.log(saveDataToFile(forRequest, 'forRequest.txt'));
    //   Logger.log(saveDataToFile(skusForShow, 'skusForShow.txt'));

    importProducts([...skusForChange, ...forRequest, ...skusForShow], token);
  }
}
//////////////////////////////////////////////////////////////


function GetSKURs(token) {
  let fullData = [];
  let offset = 0;

  while (true) {
    const data = sendPostRequest(`${domain}/api/catalog/export/`, {
      "token": token,
      "offset": offset * 500
    }).response.products;

    if (!Array.isArray(data)) {
      Logger.log("–ù–µ–≤—ñ—Ä–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç `data`, –æ—á—ñ–∫—É—î—Ç—å—Å—è –º–∞—Å–∏–≤:", data);
      break;
    }

    fullData = [...fullData, ...data];
    if (data.length <= 500) break;
    offset++;
  }

  return (fullData);
}


function Checker() {
  const token = sendPostRequest(`${domain}/api/auth/`, {
    "login": login,
    "password": password,
  }).response.token;


  Logger.log(token);
  let SKURs = GetSKURs(token);
  let Hidden = getHiddenProducts(SKURs);
  ShowUniqueArticles(Hidden);
}

function ShowUniqueArticles(SKU) {
  // –û—Ç—Ä–∏–º—É—î–º–æ —Ç–æ–∫–µ–Ω –¥–ª—è –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
  const token = sendPostRequest(`${domain}/api/auth/`, {
    login: login,
    password: password,
  }).response.token;


  Logger.log(SKU);

  // –§–æ—Ä–º—É—î–º–æ –º–∞—Å–∏–≤ –æ–±'—î–∫—Ç—ñ–≤ –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
  const skusForShow = SKU.map(sku => {
    return {
      article: sku, // –ê—Ä—Ç–∏–∫—É–ª –∑ –≤—Ö—ñ–¥–Ω–æ–≥–æ –º–∞—Å–∏–≤—É
      display_in_showcase: true,
      presence: { ua: "–ù–µ–º–∞—î –≤ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ" },
    };
  });

  // –Ø–∫—â–æ —î –¥–∞–Ω—ñ –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è, –≤–∏–∫–ª–∏–∫–∞—î–º–æ importProducts
  if (skusForShow.length > 0) {
    importProducts(skusForShow, token);
  }
  Logger.log('–û–ø—Ä–∞—Ü—å–æ–≤–∞–Ω–æ ' + SKU.length)
}
const { domain, login, password } = getScriptProperties();

function onOpen() {
  const ui = SpreadsheetApp.getUi();
  ui.createMenu('üõçÔ∏è –•–æ—Ä–æ—à–æ–ø')
    .addItem('üîÑ –û–Ω–æ–≤–∏—Ç–∏ –∫–∞—Ç–∞–ª–æ–≥', 'runUpdateCatalog')
    
    .addToUi();
}

function runUpdateCatalog() {
  const spreadsheet = SpreadsheetApp.getActiveSpreadsheet();
  spreadsheet.toast("–û–Ω–æ–≤–ª—é—é –∫–∞—Ç–∞–ª–æ–≥...", "üîÑ –û–Ω–æ–≤–ª–µ–Ω–Ω—è", 2);

  const numberOfProducts = main();

    spreadsheet.toast('–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –∑–∞–¥–∞—á—É –Ω–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è Cloud-Service.', "‚úÖ –£—Å–ø—ñ—Ö", 5);


/*
  if (numberOfProducts > 0) {
    spreadsheet.toast(`–ö–∞—Ç–∞–ª–æ–≥ –æ–Ω–æ–≤–ª–µ–Ω–æ. –û—Ç—Ä–∏–º–∞–Ω–æ ${numberOfProducts} —Ç–æ–≤–∞—Ä—ñ–≤.`, "‚úÖ –£—Å–ø—ñ—Ö", 5);
  } else {
    spreadsheet.toast("–ù–µ –≤–¥–∞–ª–æ—Å—è –æ–Ω–æ–≤–∏—Ç–∏ –∫–∞—Ç–∞–ª–æ–≥.", "‚ö†Ô∏è –ü–æ–º–∏–ª–∫–∞", 5);
  }
  */
}

// –û—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö —ñ–∑ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç–µ–π —Å–∫—Ä–∏–ø—Ç–∞
function getScriptProperties() {
  const properties = PropertiesService.getScriptProperties();
  return {
    domain: properties.getProperty('domain'),
    login: properties.getProperty('login'),
    password: properties.getProperty('password')
  };
}

function GetAu() {
  auth(login, password, domain);
}


// –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è —Ç–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Ç–æ–∫–µ–Ω—É
function auth(login, password, domain) {
  const url = `${domain}/api/auth/`;
  const payload = {
    login: login,
    password: password
  };
  const options = {
    method: 'post',
    contentType: 'application/json',
    payload: JSON.stringify(payload)
  };

  try {
    const response = UrlFetchApp.fetch(url, options);
    const data = JSON.parse(response.getContentText());
    if (data.status === "OK") {
      Logger.log('Ok!');
      return data.response.token;
    } else {
      console.error(`–ü–æ–º–∏–ª–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó: ${data.response.message || "–ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞"}`);
    }
  } catch (error) {
    console.error(`–ü–æ–º–∏–ª–∫–∞ –∑–∞–ø–∏—Ç—É: ${error.toString()}`);
  }
  return null;
}

// –ï–∫—Å–ø–æ—Ä—Ç –∫–∞—Ç–∞–ª–æ–≥—É —Ç–æ–≤–∞—Ä—ñ–≤ –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º offset —Ç–∞ limit
function exportCatalog(token, domain, offset = 0, limit = 500, includedParams = ["display_in_showcase"]) {
  const url = `${domain}/api/catalog/export/`;
  const payload = {
    token: token,
    offset: offset,
    limit: limit
    //,includedParams: includedParams//
  };
  const options = {
    method: 'post',
    contentType: 'application/json',
    payload: JSON.stringify(payload)
  };

  try {
    const response = UrlFetchApp.fetch(url, options);
    const data = JSON.parse(response.getContentText());
    if (data.status === "OK") {
      return data.response;
    } else {
      console.error(`–ü–æ–º–∏–ª–∫–∞ –µ–∫—Å–ø–æ—Ä—Ç—É –∫–∞—Ç–∞–ª–æ–≥—É: ${data.response.message || "–ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞"}`);
    }
  } catch (error) {
    console.error(`–ü–æ–º–∏–ª–∫–∞ –∑–∞–ø–∏—Ç—É: ${error.toString()}`);
  }
  return null;
}

// –û–±—Ä–æ–±–∫–∞ –¥–∞–Ω–∏—Ö –∫–∞—Ç–∞–ª–æ–≥—É
function processCatalogData(catalogData) {
  if (!catalogData || !catalogData.products) {
    console.error("–î–∞–Ω—ñ –∫–∞—Ç–∞–ª–æ–≥—É –≤—ñ–¥—Å—É—Ç–Ω—ñ –∞–±–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ñ.");
    return [];
  }

  const processedData = [];
  catalogData.products.forEach(product => {

    const rozmirTovaru = product.Rozmir?.value?.ua || '';
    const rozmrBlizni = product.rozmrBlizni?.value?.ua || '';
    const rozmrVzuttja = product.rozmrVzuttja?.value?.ua || '';

    const display_in_showcase = product.display_in_showcase || "";
    const presence = product.presence?.value?.ua || "";

    let Flag = (display_in_showcase && (presence === "–í –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ"))

    const item = {
      article: product.article,
      title: product.title.ua || "–ù–∞–∑–≤–∞ –≤—ñ–¥—Å—É—Ç–Ω—è", // –Ø–∫—â–æ title.ua –≤—ñ–¥—Å—É—Ç–Ω—ñ–π, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ "–ù–∞–∑–≤–∞ –≤—ñ–¥—Å—É—Ç–Ω—è"
      price: product.price,
      image: product.gallery_common && product.gallery_common.length > 0 ? product.gallery_common[0] : product.images && product.images.length > 0 ? product.images[0] : "",
      rozmir: rozmirTovaru + rozmrBlizni + rozmrVzuttja
    };
    if (Flag) { processedData.push(item) };
  });

  return processedData;
}


// –û—á–∏—â–µ–Ω–Ω—è –∞—Ä–∫—É—à–∞
function clearSheet(spreadsheetId, sheetName) {
  const spreadsheet = SpreadsheetApp.openById(spreadsheetId);
  let sheet = spreadsheet.getSheetByName(sheetName);

  if (!sheet) {
    sheet = spreadsheet.insertSheet(sheetName);
    // –î–æ–¥–∞—î–º–æ –∑–∞–≥–æ–ª–æ–≤–∫–∏, —è–∫—â–æ –∞—Ä–∫—É—à –Ω–æ–≤–∏–π
    sheet.appendRow(["–ê—Ä—Ç–∏–∫—É–ª", "–ù–∞–∑–≤–∞", "–¶—ñ–Ω–∞", "–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è"]);
  } else {
    // –û—á–∏—â–∞—î–º–æ –¥–∞–Ω—ñ –≤ –¥—ñ–∞–ø–∞–∑–æ–Ω—ñ A2:D
    const lastRow = sheet.getLastRow();
    if (lastRow > 1) {
      sheet.getRange(2, 1, lastRow - 1, 6).clearContent(); // –û—á–∏—â–∞—î–º–æ A2:F
    }
  }

  console.log("–ê—Ä–∫—É—à –ø—ñ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ –¥–ª—è –∑–∞–ø–∏—Å—É –¥–∞–Ω–∏—Ö.");
}
// –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö —É Google Sheets (–ø–∞–∫–µ—Ç–Ω–∏–π –∑–∞–ø–∏—Å)
function saveToGoogleSheets(data, spreadsheetId, sheetName) {
  const spreadsheet = SpreadsheetApp.openById(spreadsheetId);
  const sheet = spreadsheet.getSheetByName(sheetName);

  if (!sheet) {
    console.error("–ê—Ä–∫—É—à –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.");
    return;
  }

  // –ü–µ—Ä–µ—Ç–≤–æ—Ä—é—î–º–æ –¥–∞–Ω—ñ —É –¥–≤–æ–≤–∏–º—ñ—Ä–Ω–∏–π –º–∞—Å–∏–≤ –¥–ª—è –∑–∞–ø–∏—Å—É
  const rows = data.map(item => [item.article, item.title, item.price, item.image, item.rozmir]);

  // –ó–∞–ø–∏—Å—É—î–º–æ –¥–∞–Ω—ñ "–ø–∞–∫–µ—Ç–Ω–æ"
  sheet.getRange(2, 1, rows.length, rows[0].length).setValues(rows);
  console.log(`–î–∞–Ω—ñ —É—Å–ø—ñ—à–Ω–æ –∑–±–µ—Ä–µ–∂–µ–Ω–æ. –ó–∞–ø–∏—Å–∞–Ω–æ ${rows.length} —Ä—è–¥–∫—ñ–≤.`);
}

// –û—Å–Ω–æ–≤–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è
/*
function main_old() {
  const { domain, login, password } = getScriptProperties(); // –û—Ç—Ä–∏–º—É—î–º–æ –¥–∞–Ω—ñ –∑ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç–µ–π
  const spreadsheetId = "1QzB9N68IQizZ7F15X2Y_VpIe7HEIbk-Gf2ekGEpz0II";
  const sheetName = "–ö–∞—Ç–∞–ª–æ–≥";

  // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è —Ç–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Ç–æ–∫–µ–Ω—É
  const token = auth(login, password, domain);
  if (token) {
    console.log(`–¢–æ–∫–µ–Ω –æ—Ç—Ä–∏–º–∞–Ω–æ: ${token}`);

    let offset = 0;
    const limit = 500; // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ç–æ–≤–∞—Ä—ñ–≤ –∑–∞ –æ–¥–∏–Ω –∑–∞–ø–∏—Ç
    let allProcessedData = [];

    // –ü–æ—Å—Ç—É–ø–æ–≤–µ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—ñ–≤
    while (true) {
      console.log(`–û—Ç—Ä–∏–º–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—ñ–≤ –∑ offset=${offset}`);

      // –ï–∫—Å–ø–æ—Ä—Ç –∫–∞—Ç–∞–ª–æ–≥—É —Ç–æ–≤–∞—Ä—ñ–≤
      const catalogData = exportCatalog(token, domain, offset, limit, ["price", "price_old", "title", "images"]);
      if (!catalogData || !catalogData.products || catalogData.products.length === 0) {
        console.log("–¢–æ–≤–∞—Ä–∏ –∑–∞–∫—ñ–Ω—á–∏–ª–∏—Å—è.");
        break;
      }

      // –û–±—Ä–æ–±–∫–∞ –¥–∞–Ω–∏—Ö –∫–∞—Ç–∞–ª–æ–≥—É
      const processedData = processCatalogData(catalogData);
      allProcessedData = allProcessedData.concat(processedData);

      // –Ø–∫—â–æ –æ—Ç—Ä–∏–º–∞–Ω–æ –º–µ–Ω—à–µ —Ç–æ–≤–∞—Ä—ñ–≤, –Ω—ñ–∂ limit, —Ü–µ –æ–∑–Ω–∞—á–∞—î, —â–æ —Ü–µ –æ—Å—Ç–∞–Ω–Ω—è –ø–æ—Ä—Ü—ñ—è
      if (catalogData.products.length < limit) {
        console.log("–û—Ç—Ä–∏–º–∞–Ω–æ –æ—Å—Ç–∞–Ω–Ω—é –ø–æ—Ä—Ü—ñ—é —Ç–æ–≤–∞—Ä—ñ–≤.");
        break;
      }

      // –ó–±—ñ–ª—å—à—É—î–º–æ offset –¥–ª—è –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –∑–∞–ø–∏—Ç—É
      offset += limit;
    }

    // –û—á–∏—â–µ–Ω–Ω—è –∞—Ä–∫—É—à–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å–æ–º –Ω–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö
    clearSheet(spreadsheetId, sheetName);

    // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤—Å—ñ—Ö –¥–∞–Ω–∏—Ö —É Google Sheets
    if (allProcessedData.length > 0) {
      saveToGoogleSheets(allProcessedData, spreadsheetId, sheetName);
      console.log(`–£—Å—å–æ–≥–æ –∑–±–µ—Ä–µ–∂–µ–Ω–æ —Ç–æ–≤–∞—Ä—ñ–≤: ${allProcessedData.length}`);
      return allProcessedData.length; // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ç–æ–≤–∞—Ä—ñ–≤
    } else {
      console.log("–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è.");
      return 0;
    }
  } else {
    console.log("–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ —Ç–æ–∫–µ–Ω.");
    return 0;
  }
}
*/

function main() {
  const { domain, login, password } = getScriptProperties();
  const token = auth(login, password, domain);
  if (!token) {
    console.log("–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ —Ç–æ–∫–µ–Ω");
    return;
  }

  const payload = {
    token,
    domain,
    spreadsheetId: "1QzB9N68IQizZ7F15X2Y_VpIe7HEIbk-Gf2ekGEpz0II",
    sheetName: "–ö–∞—Ç–∞–ª–æ–≥"
  };

  const options = {
    method: 'post',
    contentType: 'application/json',
    payload: JSON.stringify(payload),
    muteHttpExceptions: true
  };


  try {
    const url = 'https://horoshop-catalog-service-933228594640.europe-west1.run.app/run-catalog';
    const res = UrlFetchApp.fetch(url, options);
    console.log('üîÅ –ó–∞–ø—É—Å–∫ –∫–∞—Ç–∞–ª–æ–≥—É –ø–µ—Ä–µ–¥–∞–Ω–æ —É —Å–µ—Ä–≤—ñ—Å. –†–µ–∑—É–ª—å—Ç–∞—Ç: ' + res);
    Logger.log('‚úÖ –°–µ—Ä–≤—ñ—Å –∑–∞–ø—É—â–µ–Ω–æ. –í—ñ–¥–ø–æ–≤—ñ–¥—å: ' + res.getResponseCode());
  } catch (err) {
    Logger.log('‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤–∏–∫–ª–∏–∫—É —Å–µ—Ä–≤—ñ—Å—É: ' + err);
  }




}
function getHiddenProducts(fullData) {
  // –ì—Ä—É–ø—É—î–º–æ —Ç–æ–≤–∞—Ä–∏ –∑–∞ parent_article
  const groupedByParent = fullData.reduce((acc, product) => {
    const parent = product.parent_article;
    if (!acc[parent]) {
      acc[parent] = [];
    }
    acc[parent].push(product);
    return acc;
  }, {});

  // –†–µ–∑—É–ª—å—Ç—É—é—á–∏–π –º–∞—Å–∏–≤
  const result = [];

  // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –∫–æ–∂–Ω—É –≥—Ä—É–ø—É
  for (const parent in groupedByParent) {
    const products = groupedByParent[parent];
    //Logger.log(parent);
    // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –≤—Å—ñ —Ç–æ–≤–∞—Ä–∏ –≤ –≥—Ä—É–ø—ñ –º–∞—é—Ç—å display_in_showcase = 0.0
    const allHidden = products.every(product => product.display_in_showcase === 0.0);

    // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ —Ö–æ—á–∞ –± –æ–¥–∏–Ω —Ç–æ–≤–∞—Ä —É –≥—Ä—É–ø—ñ –º–∞—î supplier.value = 'drop'
    const hasDropSupplier = products.some(product => product.supplier?.value === 'drop');

    // –Ø–∫—â–æ –æ–±–∏–¥–≤—ñ —É–º–æ–≤–∏ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è, –¥–æ–¥–∞—î–º–æ –æ–¥–∏–Ω –∑ —Ç–æ–≤–∞—Ä—ñ–≤ –¥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
    if (allHidden && hasDropSupplier && products.length > 0) {
      // –ë–µ—Ä–µ–º–æ –ø–µ—Ä—à–∏–π —Ç–æ–≤–∞—Ä –∑ –≥—Ä—É–ø–∏, —è–∫–∏–π –º–∞—î supplier.value = 'drop'
      const selectedProduct = products.find(product => product.supplier?.value === 'drop');
      if (selectedProduct) {
        Logger.log(selectedProduct.article);
        result.push(selectedProduct.article);
      }
    }
  }
  return result;

}
function saveDataToFile(data, filename) {
  // –ü–µ—Ä–µ—Ç–≤–æ—Ä—é—î–º–æ –¥–∞–Ω—ñ —É JSON-—Ä—è–¥–æ–∫
  const dataString = JSON.stringify(data, null, 2);

  // –°—Ç–≤–æ—Ä—é—î–º–æ —Ñ–∞–π–ª –Ω–∞ Google –î–∏—Å–∫—É
  const file = DriveApp.createFile(filename, dataString, MimeType.PLAIN_TEXT);

  // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ URL —Ñ–∞–π–ª—É
  return file.getUrl();
}

function GetData() {
  const token = sendPostRequest(`${domain}/api/auth/`, {
    login: login,
    password: password,
  }).response.token;

  const skuData = GetSKURs(token);

  // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –¥–∞–Ω—ñ —É —Ñ–∞–π–ª –Ω–∞ Google –î–∏—Å–∫—É
  const fileUrl = saveDataToFile(skuData, 'sku_data.txt');

  // –í–∏–≤–æ–¥–∏–º–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Ñ–∞–π–ª —É –∫–æ–Ω—Å–æ–ª—å
  console.log('–î–∞–Ω—ñ –∑–±–µ—Ä–µ–∂–µ–Ω–æ —É —Ñ–∞–π–ª –Ω–∞ Google –î–∏—Å–∫—É:', fileUrl);
}


function X() {
  const token = sendPostRequest(`${domain}/api/auth/`, {
    "login": login,
    "password": password,
  }).response.token;


  // –û—Ç—Ä–∏–º—É—î–º–æ –≤—Å—ñ —Ç–æ–≤–∞—Ä–∏ –∑ –º–∞–≥–∞–∑–∏–Ω—É
  const skus = exportProductsSKUs(token);

  // –ü–µ—Ä–µ—Ç–≤–æ—Ä—é—î–º–æ skus —É –º–∞—Å–∏–≤ –æ–±'—î–∫—Ç—ñ–≤
  const formattedSkus = skus.map(sku => ({
    article: sku[0], // –ê—Ä—Ç–∏–∫—É–ª
    supplier: { value: sku[1] || null }, // –ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫
    presence: { ua: sku[2] }, // –ù–∞—è–≤–Ω—ñ—Å—Ç—å
    display_in_showcase: sku[3], // –°—Ç–∞—Ç—É—Å –ø–æ–∫–∞–∑—É
    parent_article: sku[4] // –ë–∞—Ç—å–∫—ñ–≤—Å—å–∫–∏–π –∞—Ä—Ç–∏–∫—É–ª
  }));

  Logger.log(formattedSkus);

}



function Y() {

  Logger.log(getProductsFromMirrorSheet());

}
function GetHoroshop() {
  const url = 'https://horoshop-service-933228594640.europe-west1.run.app/api/sync';

  Logger.log('–§—É–Ω–∫—Ü—ñ—é –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ –≤ Google Cloud ' + url);

  const options = {
    method: 'get', 
    muteHttpExceptions: true,
  };

  try {
   // const response = UrlFetchApp.fetch(url, options);
    Logger.log('‚úÖ –°–µ—Ä–≤—ñ—Å –∑–∞–ø—É—â–µ–Ω–æ');
  } catch (err) {
    Logger.log('‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤–∏–∫–ª–∏–∫—É —Å–µ—Ä–≤—ñ—Å—É: ' + err);
  }
  //https://horoshop-service-933228594640.europe-west1.run.app/api/sync
  
/*
  const token = sendPostRequest(`${domain}/api/auth/`, {
    "login": login,
    "password": password,
  }).response.token;


  const skus = exportProductsSKUs(token);

  // –ü–µ—Ä–µ—Ç–≤–æ—Ä—é—î–º–æ skus —É –º–∞—Å–∏–≤ –æ–±'—î–∫—Ç—ñ–≤
  const formattedSkus = skus.map(sku => ({
    article: sku[0], // –ê—Ä—Ç–∏–∫—É–ª
    supplier: { value: sku[1] || null }, // –ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫
    presence: { ua: sku[2] }, // –ù–∞—è–≤–Ω—ñ—Å—Ç—å
    display_in_showcase: sku[3], // –°—Ç–∞—Ç—É—Å –ø–æ–∫–∞–∑—É
    parent_article: sku[4], // –ë–∞—Ç—å–∫—ñ–≤—Å—å–∫–∏–π –∞—Ä—Ç–∏–∫—É–ª
    price: sku[5] // —Ü—ñ–Ω–∞
  }));

  const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName("–•–æ—Ä–æ—à–æ–ø");



  const headers = [
    "–ê—Ä—Ç–∏–∫—É–ª",
    "–ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫",
    "–ù–∞—è–≤–Ω—ñ—Å—Ç—å (UA)",
    "–¶—ñ–Ω–∞",
    "–°—Ç–∞—Ç—É—Å –ø–æ–∫–∞–∑—É",
    "–ë–∞—Ç—å–∫—ñ–≤—Å—å–∫–∏–π –∞—Ä—Ç–∏–∫—É–ª"
  ];



  // –§–æ—Ä–º—É—î–º–æ –¥–∞–Ω—ñ –¥–ª—è –≤–∏–≤–æ–¥—É
  const data = formattedSkus.map(item => [
    item.article,
    item.supplier.value,
    item.presence.ua,
    item.price,
    item.display_in_showcase,
    item.parent_article
  ]);


  if (data.length > 0) {
    sheet.clearContents();
    sheet.getRange(1, 1, 1, headers.length).setValues([headers]);
    sheet.getRange(2, 1, data.length, headers.length).setValues(data);
  }


  for (let i = 1; i <= headers.length; i++) {
    sheet.autoResizeColumn(i);
  }
  */
}


//////

function getProductsFromMirrorSheet() {
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName("–•–æ—Ä–æ—à–æ–ø");
  const data = sheet.getDataRange().getValues();
  
  const rows = data.slice(1);

  const formattedSkus = rows.map(row => ({
    article: row[0], // –ê—Ä—Ç–∏–∫—É–ª
    supplier: { value: row[1] || null }, // –ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫
    presence: { ua: row[2] }, // –ù–∞—è–≤–Ω—ñ—Å—Ç—å (UA)
    display_in_showcase: row[4], // –°—Ç–∞—Ç—É—Å –ø–æ–∫–∞–∑—É
    parent_article: row[5] // –ë–∞—Ç—å–∫—ñ–≤—Å—å–∫–∏–π –∞—Ä—Ç–∏–∫—É–ª
  }));

  return formattedSkus;
}

–æ—Å—å –∫–æ–¥ —ñ –¢–ó –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–∞–π—Ç—É –Ω–∞ –•–æ—Ä–æ—à–æ–ø

–ü—Ä–æ–µ–∫—Ç: –ú–∞–≥–∞–∑–∏–Ω –æ–¥—è–≥—É —ñ –≤–∑—É—Ç—Ç—è. https://whitehall.store/  –ü–ª–∞–Ω—É—î—Ç—å—Å—è 100–∫+ —Ç–æ–≤–∞—Ä—ñ–≤ + —Ä–æ–∑–º—ñ—Ä–∏. –ó–∞–≥–∞–ª–æ–º –±–ª–∏–∑—å–∫–æ 300–∫ —Ç–æ–≤–∞—Ä—ñ–≤. –ü—Ä–∞—Ü—é—î –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ñ –•–æ—Ä–æ—à–æ–ø. –°–∞–º–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –º–∞—î –ª—ñ–º—ñ—Ç 250–∫ —Ç–æ–≤–∞—Ä—ñ–≤ (—Ä–∞–∑–æ–º –∑ —Ä–æ–∑–º—ñ—Ä–∞–º–∏). –ü—Ä–∏ –π–æ–≥–æ –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—ñ –ø–ª–∞–Ω—É—î–º–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–∏ –Ω–∞ —Å–∞–º–æ–ø–∏—Å–Ω–µ —Ä—ñ—à–µ–Ω–Ω—è —Ç–∏–ø—É Laravel. –ü–æ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –∑—Ä–æ–±—ñ—Ç—å —Ç–∞–∫, —â–æ–± –ø–æ—Ç—ñ–º –≤—Å–µ –º–æ–∂–Ω–∞ –±—É–ª–æ –ª–µ–≥–∫–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏.

–Ø–∫ –º–∏ —Ä–∞–Ω—ñ—à–µ –ø—Ä–∞—Ü—é–≤–∞–ª–∏. 
–°–ø–æ—á–∞—Ç–∫—É —á–µ—Ä–µ–∑ Apps Script –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Ç–∞–±–ª–∏—Ü—å. –ê–ª–µ —Ç–∞–º —î –æ–±–º–µ–∂–µ–Ω–Ω—è –≤ 360 —Å–µ–∫—É–Ω–¥ –Ω–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ—ó. –¢–æ–º—É –ø–µ—Ä–µ–π—à–ª–∏ –ø—ñ–∑–Ω—ñ—à–µ –Ω–∞ Google Cloud.


–ó–∞—Ä–∞–∑ —î –ø—Ä–æ–±–ª–µ–º–∞: –î–æ–¥–∞–ª–æ—Å—è –±–∞–≥–∞—Ç–æ —Ä—è–¥–∫—ñ–≤ —É —Ç–∞–±–ª–∏—Ü—é. 100–∫+ –≤–∂–µ. –¢–∞–±–ª–∏—Ü—ñ –Ω–µ –ø—Ä–∞—Ü—é—é—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω–æ.



–ó–∞–¥–∞—á–∞ 1. –ó–±—ñ—Ä —ñ –æ–±—Ä–æ–±–∫–∞ —Ç–∞–±–ª–∏—Ü—å –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫—ñ–≤.

–ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—å –Ω–∞–º –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Å–≤–æ—ó —Ç–∞–±–ª–∏—Ü—ñ –≤ Google Sheets. –Ü –∫–æ–∂–µ–Ω –ø–æ-—Ä—ñ–∑–Ω–æ–º—É —Ä–æ–∑–º—ñ—â—É—î —Å—Ç–æ–≤–ø—Ü—ñ.

–ù–∞ –¥–∞–Ω–∏–π –º–æ–º–µ–Ω—Ç —Ü—è —Ñ—É–Ω–∫—Ü—ñ—è –ø—Ä–∞—Ü—é—î –≤—Å–µ —â–µ –≤ —Ç–∞–±–ª–∏—Ü—è—Ö —ñ –≤–∂–µ –≤–ø–µ—Ä–ª–∏—Å—è –≤ –ª—ñ–º—ñ—Ç –ø–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—é







–¢–∞–±–ª–∏—Ü—ñ —Ç—Ä–µ–±–∞ –≤—Å—ñ –∑ º—î–¥–Ω–∞—Ç–∏, –≤—ñ–¥—Ñ—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏ –ø–æ –∞–ª—Ñ–∞–≤—ñ—Ç—É –∑–∞ —Å—Ç–æ–≤–ø—Ü–µ–º –ê—Ä—Ç–∏–∫—É–ª —ñ –∑–±–µ—Ä–µ–≥—Ç–∏ –≤ –æ–∫—Ä–µ–º–∏–π —Ñ–∞–π–ª —á–∏ —Ç–∞–±–ª–∏—Ü—é. –î–ª—è —Ç–æ–≥–æ, —â–æ–± –∫–æ–ª–∏ –≤ —è–∫–æ–≥–æ—Å—å –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞ —Ä–∞–ø—Ç–æ–≤–æ –∑–∞–∫—ñ–Ω—á–∏—Ç—å—Å—è —Ç–æ–≤–∞—Ä, –º–∏ —à–≤–∏–¥–∫–æ –º–æ–≥–ª–∏ –ø–æ–¥–∏–≤–∏—Ç–∏—Å—è —Ö—Ç–æ ‚Äú–ø—ñ–¥ –Ω–∏–º‚Äù —â–µ –º–∞—î –≤ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ.
–û–±—Ä–æ–±–∫–∞ —Ü—ñ—î—ó —Ç–∞–±–ª–∏—Ü—ñ. –ó–∞–ª–∏—à–∏—Ç–∏ –≤ –Ω—ñ–π —Ç—ñ–ª—å–∫–∏ —Ç—ñ –∞—Ä—Ç–∏–∫—É–ª–∏, –¥–µ –Ω–∞–π–º–µ–Ω—à–∞ —Ü—ñ–Ω–∞ —Ç–æ–≤–∞—Ä—É. –í Google Sheets —Ü–µ –∫–ª–∞—Å–Ω–æ –ø—Ä–∞—Ü—é—î —á–µ—Ä–µ–∑ –î–∞–Ω—ñ - –û—á–∏—â–µ–Ω–Ω—è –î–∞–Ω–∏—Ö - –í–∏–ª—É—á–∏—Ç–∏ –∫–æ–ø—ñ—ó (–ø–æ —Å—Ç–æ–≤–ø—Ü—é –ê—Ä—Ç–∏–∫—É–ª)
–î–æ–¥–∞—Ç–∏ –Ω–∞—Ü—ñ–Ω–∫—É –¥–æ –≤—Ö—ñ–¥–Ω–∏—Ö —Ü—ñ–Ω. –ú–∞—î –±—É—Ç–∏ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –∑–∞–¥–∞–≤–∞—Ç–∏ –≤–ª–∞—Å–Ω–∏–π –≤—ñ–¥—Å–æ—Ç–æ–∫ –Ω–∞—Ü—ñ–Ω–∫–∏ –¥–æ –∫–æ–∂–Ω–æ–≥–æ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞

–†–µ–∑—É–ª—å—Ç–∞—Ç: —Ç–∞–±–ª–∏—Ü—è –∑ —É–Ω—ñ–∫–∞–ª—å–Ω–∏–º–∏ –∞—Ä—Ç–∏–∫—É–ª–∞–º–∏. –ì–æ—Ç–æ–≤–∞ —â–æ–± —ó—ó –∑–∞–ø—É—à–∏—Ç–∏ –Ω–∞ —Å–∞–π—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—É –ù–∞—è–≤–Ω–æ—Å—Ç—ñ —Ç–∞ –¶—ñ–Ω.






–ó–∞–¥–∞—á–∞ 2. –û–Ω–æ–≤–∏—Ç–∏ –ù–∞—è–≤–Ω—ñ—Å—Ç—å –Ω–∞ —Å–∞–π—Ç—ñ
–ö–ª—é—á - –ê—Ä—Ç–∏–∫—É–ª

–û–Ω–æ–≤–∏—Ç–∏ 2 –ø–æ–ª—è:
–¶—ñ–Ω–∞
–í–∏–¥–∏–º—ñ—Å—Ç—å (—Ç–∞–∫/–Ω—ñ)

–Ø–∫—â–æ –∞—Ä—Ç–∏–∫—É–ª—É –Ω–µ–º–∞—î –≤ —Ç–∞–±–ª–∏—Ü—ñ - –ù—ñ
–Ø–∫—â–æ —î - –¢–∞–∫


–û–Ω–æ–≤–ª—é–≤–∞—Ç–∏ —Ü–µ –≤—Å–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –º—ñ–Ω—ñ–º—É–º —Ä–∞–∑ –≤ –¥–µ–Ω—å. –ê –∫—Ä–∞—â–µ 2-3 —Ä–∞–∑–∏.

–ß–∞—Å—Ç–∏–Ω–∞ –∫–æ–¥—É —ñ–º–ø–æ—Ä—Ç—É



–ù–∞ –¥–∞–Ω–∏–π –º–æ–º–µ–Ω—Ç —Ü—è —Ñ—É–Ω–∫—Ü—ñ—è –ø—Ä–∞—Ü—é—î –≤ Google Cloud. –ù—ñ–±–∏ –≤—Å–µ –¥–æ–±—Ä–µ. –ê–ª–µ –≤–æ–Ω–∞ –Ω–µ –æ—Ç—Ä–∏–º—É—î –ø–æ–≤–Ω–∏–π —Å–ø–∏—Å–æ–∫, –±–æ –≤ –ó–∞–¥–∞—á–∞ 1 –≤–∂–µ –≤–ø–µ—Ä–ª–∏—Å—è –≤ –ª—ñ–º—ñ—Ç





‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî

–¢–∞–±–ª–∏—Ü—ñ —Ç—Ä–µ–±–∞ –≤—Å—ñ –∑ º—î–¥–Ω–∞—Ç–∏, –≤—ñ–¥—Ñ—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏ –ø–æ –∞–ª—Ñ–∞–≤—ñ—Ç—É –∑–∞ —Å—Ç–æ–≤–ø—Ü–µ–º –ê—Ä—Ç–∏–∫—É–ª —ñ –∑–±–µ—Ä–µ–≥—Ç–∏ –≤ –æ–∫—Ä–µ–º–∏–π —Ñ–∞–π–ª —á–∏ —Ç–∞–±–ª–∏—Ü—é. –î–ª—è —Ç–æ–≥–æ, —â–æ–± –∫–æ–ª–∏ –≤ —è–∫–æ–≥–æ—Å—å –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞ —Ä–∞–ø—Ç–æ–≤–æ –∑–∞–∫—ñ–Ω—á–∏—Ç—å—Å—è —Ç–æ–≤–∞—Ä, –º–∏ —à–≤–∏–¥–∫–æ –º–æ–≥–ª–∏ –ø–æ–¥–∏–≤–∏—Ç–∏—Å—è —Ö—Ç–æ ‚Äú–ø—ñ–¥ –Ω–∏–º‚Äù —â–µ –º–∞—î –≤ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ.
–û–±—Ä–æ–±–∫–∞ —Ü—ñ—î—ó —Ç–∞–±–ª–∏—Ü—ñ. –ó–∞–ª–∏—à–∏—Ç–∏ –≤ –Ω—ñ–π —Ç—ñ–ª—å–∫–∏ —Ç—ñ –∞—Ä—Ç–∏–∫—É–ª–∏, –¥–µ –Ω–∞–π–º–µ–Ω—à–∞ —Ü—ñ–Ω–∞ —Ç–æ–≤–∞—Ä—É. –í Google Sheets —Ü–µ –∫–ª–∞—Å–Ω–æ –ø—Ä–∞—Ü—é—î —á–µ—Ä–µ–∑ –î–∞–Ω—ñ - –û—á–∏—â–µ–Ω–Ω—è –î–∞–Ω–∏—Ö - –í–∏–ª—É—á–∏—Ç–∏ –∫–æ–ø—ñ—ó (–ø–æ —Å—Ç–æ–≤–ø—Ü—é –ê—Ä—Ç–∏–∫—É–ª)
–î–æ–¥–∞—Ç–∏ –Ω–∞—Ü—ñ–Ω–∫—É –¥–æ –≤—Ö—ñ–¥–Ω–∏—Ö —Ü—ñ–Ω. –ú–∞—î –±—É—Ç–∏ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –∑–∞–¥–∞–≤–∞—Ç–∏ –≤–ª–∞—Å–Ω–∏–π –≤—ñ–¥—Å–æ—Ç–æ–∫ –Ω–∞—Ü—ñ–Ω–∫–∏ –¥–æ –∫–æ–∂–Ω–æ–≥–æ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞. 
–î–æ–¥–∞—Ç–∫–æ–≤—ñ —Ñ—É–Ω–∫—Ü—ñ—ó
–ù–∞—Ü—ñ–Ω–∫–∞. –ú–∞—î –±—É—Ç–∏ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω–∞ –ª–æ–≥—ñ–∫–∞. –Ø–∫—â–æ –ø—Ä–∏–±—É—Ç–æ–∫ –Ω–∞ —Ç–æ–≤–∞—Ä—ñ –ø—ñ—Å–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è % –Ω–∞—Ü—ñ–Ω–∫–∏ —î –º–µ–Ω—à–∏–π –Ω—ñ–∂ 500 –≥—Ä–Ω. –¢—Ä–µ–±–∞ –ø–æ—Å—Ç–∞–≤–∏—Ç–∏ –Ω–∞—Ü—ñ–Ω–∫—É 500 –≥—Ä–Ω. –Ø–∫—â–æ –ø—Ä–∏–±—É—Ç–æ–∫ >= 500 –≥—Ä–Ω, –∑–∞–ª–∏—à–∞—î–º–æ —è–∫ —î.
–¶—ñ–Ω–∏ –º–∞—é—Ç—å –±—É—Ç–∏ –∑–∞–æ–∫—Ä—É–≥–ª–µ–Ω—ñ –¥–æ 10 –≥—Ä–Ω –≤ –±—ñ–ª—å—à—É —Å—Ç–æ—Ä–æ–Ω—É. –ù–∞–ø—Ä–∏–∫–ª–∞–¥ 1897 –≥—Ä–Ω –≤–∏—Ö–æ–¥–∏—Ç—å –ø–æ —Ñ–æ—Ä–º—É–ª—ñ. –¢–æ–¥—ñ –ø–∏—à–µ–º–æ 1900 –≥—Ä–Ω.
–ú–∞—î –±—É—Ç–∏ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –∑–∞–¥–∞–≤–∞—Ç–∏ –≤–ª–∞—Å–Ω—ñ —Ü—ñ–Ω–∏. –î–ª—è —Ü—å–æ–≥–æ –º–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–ª–∏ —Ç–∞–±–ª–∏—Ü—é ¬´–†—É—á–Ω–∏–π —Å–∫–ª–∞–¥¬ª. –î–µ –≤–ø–∏—Å—É—î—Ç—å—Å—è –∞—Ä—Ç–∏–∫—É–ª —ñ –ø–æ—Ç—Ä—ñ–±–Ω–∞ —Ü—ñ–Ω–∞. –Æ–∑–∫–µ–π—Å - –≤ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞ —î —Ç–æ–≤–∞—Ä –ø–æ –∑–∞–∫—É–ø—Ü—ñ 5000 –≥—Ä–Ω. –í–∏—Å—Ç–∞–≤–ª–µ–Ω–∞ –≤ –Ω–∞—Å –Ω–∞—Ü—ñ–Ω–∫–∞ 20%. –í —Ñ—ñ–Ω–∞–ª—ñ –Ω–∞ —Å–∞–π—Ç—ñ –æ—Ç—Ä–∏–º—É—î–º–æ 6000 –≥—Ä–Ω. –ú–∏ –∑–∞–≤–µ–∑–ª–∏ —Ç–æ–≤–∞—Ä –Ω–∞ —Å–≤—ñ–π —Å–∫–ª–∞–¥. –ó–∞–∫—É–ø–∫–∞ 5500 –≥—Ä–Ω –∞–±–æ –Ω–µ –≤–∞–∂–ª–∏–≤–æ –Ω–∞–≤—ñ—Ç—å —è–∫–∞. –•–æ—á–µ–º–æ –ø—Ä–æ–¥–∞–≤–∞—Ç–∏ –ø–æ 7000 –≥—Ä–Ω.

–í–∞–∂–ª–∏–≤–∏–π –º–æ–º–µ–Ω—Ç –ø–æ –≤—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö.
–ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫ –≤ —Ä–∞–Ω–¥–æ–º–Ω–∏–π –º–æ–º–µ–Ω—Ç –º–æ–∂—É—Ç—å –∑–º—ñ–Ω–∏—Ç–∏:
- –Ω–∞–∑–≤–∞ —Ç–∞–±–ª–∏—Ü—ñ
- –Ω–∞–∑–≤–∞ –∞—Ä–∫—É—à–∞
- –ø–µ—Ä–µ—Å—Ç–∞–≤–∏—Ç–∏ –∫–æ–ª–æ–Ω–∫–∏ –º—ñ—Å—Ü—è–º–∏
–¢–æ–¥—ñ –¥–æ–±—Ä–µ —è–∫—ñ—Å—å –ª–æ–≥–∏ –ø–æ—Å—Ç–∞–≤–∏—Ç–∏, —â–æ–± –ø–æ—Ç—ñ–º –ø–æ–±–∞—á–∏—Ç–∏. –Ü —Ä–æ–∑—Ä–æ–±–ª—è—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—é —Ç–∞–∫ —â–æ–± –ø–æ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –Ω–µ –ø—Ä–∏–≤ º—è–∑—É–≤–∞—Ç–∏ –¥–æ —Ü–∏—Ö –ø–æ–ª—ñ–≤



–ó–∞–¥–∞—á–∞ 2
–û–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—ñ–≤
–ë–µ—Ä–µ–º–æ –ö–ª—é—á - –ê—Ä—Ç–∏–∫—É–ª
 –ø–æ –Ω—å–æ–º—É –æ–Ω–æ–≤–ª—é—î–º–æ 2 –ø–æ–ª—è:
–¶—ñ–Ω–∞
–í–∏–¥–∏–º—ñ—Å—Ç—å (—Ç–∞–∫/–Ω—ñ)
–Ø–∫—â–æ –∞—Ä—Ç–∏–∫—É–ª—É –Ω–µ–º–∞—î –≤ —Ç–∞–±–ª–∏—Ü—ñ - –ù—ñ
–Ø–∫—â–æ —î - –¢–∞–∫
–û–Ω–æ–≤–ª—é–≤–∞—Ç–∏ —Ü–µ –≤—Å–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –º—ñ–Ω—ñ–º—É–º —Ä–∞–∑ –≤ –¥–µ–Ω—å. –ê –∫—Ä–∞—â–µ 2-3 —Ä–∞–∑–∏.
–ú–∞—î –±—É—Ç–∏ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –≤—Ä—É—á–Ω—É –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è



